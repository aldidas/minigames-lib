<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Snake Game Test</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: system-ui, -apple-system, sans-serif;
        background: #1f2937;
        color: #f9fafb;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
      }

      h1 {
        margin-top: 0;
        color: #3b82f6;
      }

      .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
      }

      canvas {
        border: 3px solid #3b82f6;
        border-radius: 8px;
        background: #111827;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      }

      .controls {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
      }

      button {
        padding: 12px 24px;
        font-size: 16px;
        font-weight: 600;
        border: none;
        border-radius: 6px;
        background: #3b82f6;
        color: white;
        cursor: pointer;
        transition: all 0.2s;
      }

      button:hover {
        background: #2563eb;
        transform: translateY(-2px);
      }

      button:active {
        transform: translateY(0);
      }

      .info {
        text-align: center;
        max-width: 600px;
      }

      .score {
        font-size: 24px;
        font-weight: bold;
        color: #3b82f6;
        margin: 10px 0;
      }

      .instructions {
        background: #374151;
        padding: 20px;
        border-radius: 8px;
        margin-top: 20px;
      }

      .instructions h3 {
        margin-top: 0;
        color: #8b5cf6;
      }

      .instructions ul {
        text-align: left;
        margin: 10px 0;
      }

      .event-log {
        background: #111827;
        border: 2px solid #374151;
        border-radius: 8px;
        padding: 15px;
        max-height: 200px;
        overflow-y: auto;
        width: 100%;
        max-width: 600px;
        font-family: "Courier New", monospace;
        font-size: 12px;
      }

      .event {
        margin: 5px 0;
        padding: 5px;
        border-left: 3px solid #3b82f6;
        padding-left: 10px;
      }

      .event.game-over {
        border-left-color: #ef4444;
      }

      .event.score-update {
        border-left-color: #10b981;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üêç Snake Game Test</h1>

      <canvas id="gameCanvas" width="600" height="600"></canvas>

      <div class="score" id="score">Score: 0</div>

      <div class="controls">
        <button id="startBtn">Start Game</button>
        <button id="pauseBtn">Pause</button>
        <button id="resumeBtn">Resume</button>
        <button id="stopBtn">Stop</button>
      </div>

      <div class="info">
        <div class="instructions">
          <h3>How to Play</h3>
          <ul>
            <li><strong>Desktop:</strong> Use Arrow Keys or WASD to move</li>
            <li><strong>Mobile:</strong> Swipe in direction you want to go</li>
            <li>Eat the red food to grow and score points</li>
            <li>Don't hit the walls or yourself!</li>
          </ul>
        </div>
      </div>

      <div class="event-log" id="eventLog">
        <div style="color: #8b5cf6; font-weight: bold; margin-bottom: 10px">
          EVENT LOG
        </div>
      </div>
    </div>

    <script type="module">
      import { SnakeGame } from "./packages/snake/dist/index.js";

      const canvas = document.getElementById("gameCanvas");
      const scoreDisplay = document.getElementById("score");
      const eventLog = document.getElementById("eventLog");

      // Create game instance
      const game = new SnakeGame(canvas, {
        colors: {
          primary: "#3b82f6",
          secondary: "#8b5cf6",
          background: "#111827",
          text: "#f9fafb",
        },
      });

      // Set player name
      game.setPlayerName("Test Player");

      // Event listeners
      game.on("gameStarted", (data) => {
        addEvent(
          "gameStarted",
          `Game started at ${new Date(data.timestamp).toLocaleTimeString()}`
        );
      });

      game.on("scoreUpdate", (data) => {
        scoreDisplay.textContent = `Score: ${data.score}`;
        addEvent(
          "scoreUpdate",
          `Score: ${data.score} (+${data.delta})`,
          "score-update"
        );
      });

      game.on("gameOver", (data) => {
        addEvent(
          "gameOver",
          `Game Over! Reason: ${data.reason}. Final Score: ${data.finalScore}`,
          "game-over"
        );
        alert(
          `Game Over! Reason: ${data.reason}\\nFinal Score: ${data.finalScore}`
        );
      });

      game.on("gameFinished", (data) => {
        addEvent(
          "gameFinished",
          `Game finished at ${new Date(data.timestamp).toLocaleTimeString()}`
        );
      });

      // Button controls
      document.getElementById("startBtn").addEventListener("click", () => {
        scoreDisplay.textContent = "Score: 0";
        game.start();
      });

      document.getElementById("pauseBtn").addEventListener("click", () => {
        game.pause();
        addEvent("pause", "Game paused");
      });

      document.getElementById("resumeBtn").addEventListener("click", () => {
        game.resume();
        addEvent("resume", "Game resumed");
      });

      document.getElementById("stopBtn").addEventListener("click", () => {
        game.stop();
      });

      // Event log helper
      function addEvent(type, message, className = "") {
        const eventDiv = document.createElement("div");
        eventDiv.className = `event ${className}`;
        eventDiv.innerHTML = `<strong>[${type}]</strong> ${message}`;
        eventLog.appendChild(eventDiv);
        eventLog.scrollTop = eventLog.scrollHeight;
      }

      // Start game automatically
      addEvent("info", 'Click "Start Game" or press any arrow key to begin!');
    </script>
  </body>
</html>
